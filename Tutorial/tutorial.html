<!doctype HTML5>
<html>
<head>
    <title>Grails Offline Fishing App Tutorial</title>
    <style>
        #content {
            width: 75%;
            margin: auto;
        }

		pre code {
			background-color: #eee;
			border: 1px solid #999;
			display: block;
			padding: 20px;
            overflow-x: scroll;
		}

        code {
            background-color: #eee;
            border: 1px solid #999;
            padding: 4px;
        }

        .w3-animate-fading{animation:fading 6s infinite}@keyframes fading{0%{opacity:0}50%{opacity:1}100%{opacity:0}}

        .mySlides img {
            max-width: 100%;
            max-height: 350px;
        }

        .imageHolder {
            width: 50%;
            height: 365px;
            margin: auto;
            padding-bottom: 25px
        }

    </style>
</head>
<body>
    <div id='content'>
        <h2>Grails Offline Fishing App Tutorial</h2>
        <p>By <a href='https://github.com/jakemager'>Jake Mager</a></p>
        <hr>

        <h3>Introduction</h3>
        <p>This tutorial covers the basics and everything you need to get started with offline support when developing with Grails.</p>
        <p>A great introduction to start creating <a href="https://developers.google.com/web/progressive-web-apps/">progressive web apps (PWA)</a> and using
            <a href="https://developers.google.com/web/ilt/pwa/caching-files-with-service-worker">service workers</a> with Grails.
        </p>
        
        <p>We will be creating an offline Fishing App to demonstarte this. The following will be covered:</p>
        <ul>
            <li>Building a Grails App</li>
            <li>Spring Security Login</li>
            <li>Adding to the Grails database using <a href="http://api.jquery.com/jquery.ajax/">ajax</a></li>
            <li>Handling offline interactions</li>
            <li>Building an offline queue with <a href="https://localforage.github.io/localForage/">localforage</a></li>
            <li>Image Uploading</li>
            <li>Bootstrap Modals</li>
            <li>Geolocation</li>
        </ul>

        <p>However, the app will not be 100% done by the end of the tutorial, what won't be covered:</p>
        <ul>
            <li>Spring Security Registration</li>
            <li>Styling (however a .css will be included)</li>
            <li>Using multiple pages</li>
            <li>Full PWA capabilities</li>
        </ul>

        <h3>Prerequisites</h3>
        <ul>
            <li>It is recommended that you have completed all the programming assignements on <a href="http://cs4760.csl.mtu.edu/2018/assignments/cs4760-assignments/programming-assignments/">cs4760.cs.mtu.edu</a>, but 
                this tutorial will go step by step and be as in depth as possible.
            </li>
            <li>Basic knowledge of <u>HTML</u> and <u>jQuery</u> is <b>required</b></li>
            <li>We will be using <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a></li>
        </ul>

        <h3>Finished Web App</h3>
        <div class="imageHolder">
            <div class="mySlides w3-animate-fading">
                <img src="images/HomePage.png" />
                <p>Home Page</p>
            </div>
            <div class="mySlides w3-animate-fading">        
                <img  src="images/Login.png" />
                <p>Login</p>
            </div>
            <div class="mySlides w3-animate-fading">        
                <img  src="images/NewLog.png" />
                <p>New Catch</p>
            </div>
            <div class="mySlides w3-animate-fading">        
                <img  src="images/NewLogWithParameters.png" />
                <p>New Catch Filled</p>
            </div>
            <div class="mySlides w3-animate-fading">        
                <img  src="images/Queue.png" />
                <p>Items pending in queue</p>
            </div>
            <div class="mySlides w3-animate-fading">        
                <img  src="images/QueueUploaded.png" />
                <p>Queue Uploaded</p>
            </div>
            <div class="mySlides w3-animate-fading">        
                <img  src="images/CatchDetail.png" />   
                <p>Catch Details</p>
            </div>    
            <div class="mySlides w3-animate-fading">        
                <img  src="images/CatchEdit.png" />
                <p>Catch Details Edit Mode</p>
            </div>
        </div>
        
        <h4>Features:</h4>
        <ul>
            <li>User Login</li>
            <li>Offline Access</li>
            <li>Saving fish catches with an image</li>
            <li>Saving offline catches into queue until back online</li>
            <li>Viewing the catches</li>
            <li>Editing catch</li>
        </ul>
        <br /><br /><br />

        <h3>Let's Get Started</h3>

        <p>Go on ahead and open IntelliJ and create a New Project and select the <img src='https://zeroturnaround.com/wp-content/uploads/2015/02/grails_logo.png' width=15px /> Grails project on the left menu of the New Project Window</p>
        <p>Let's name our project "FishingApp"</p>
        <p>First things first, lets setup Spring Security Users</p>
        <br /><hr><br />

        <h3>Step 1: Setting Up Users</h3>
        <p>We will use the Spring Security Core plugin with an additional plugin, the Spring Security UI plugin. The Spring Security Core authenticates users and control access to pages.  The Spring Security UI provides convenient UI  for controlling access and users.</p>
        <p>Documentation: 
            <a href='http://grails-plugins.github.io/grails-spring-security-core/3.2.x/index.html'>Spring Security Core</a>, 
            <a href='https://grails-plugins.github.io/grails-spring-security-ui/latest/'>Spring Security UI</a>
        </p>
        <p>To install plugins, all you need to do is to list them in <img src='images/buildGradle.png' /> file. Near the bottom of the 
            <img src='images/buildGradle.png' /> file, you should see a long list of dependencies. Cut and paste into this dependencies list the declarations below:</p>
        <pre>
            <code>dependencies {
        ...
        // Adds Spring Security plugins
        compile 'org.grails.plugins:spring-security-core:3.2.0'
        compile 'org.grails.plugins:spring-security-ui:3.1.1'
        compile 'org.grails.plugins:mail:2.0.0.RC6'

    }</code>
        </pre>

        <p>Now setup Spring Security Core.</p>
        <p>Open the Grails command prompt by clicking the “Tools” in the menu bar then select “Grails” followed by “Grails Command”. In the widow that pops up enter:</p>
        <pre><code>s2-quickstart fishingapp User Role</code></pre>    
        <img src='images/runGrailsCmd.png' />

        <p>Then add the following to the bottom of <b>grails-app → conf → application.groovy</b></p>
        <pre><code>grails.plugin.springsecurity.logout.postOnly = false</code></pre>
        <p>This will make logging out simple in the future</p>

        <p>Well we are here, also add the following under <code>grails:</code> at the top.</p>
        <pre><code>resources:
        pattern: '/**'</code></pre>
        <p>This will help us when we use the webapp folder later in the tutorial</p>


        <br /><hr><br />

        <h3>Step 2: Creating Controller and Domain</h3>
        <p>Before we make any new domains or controllers lets modify the User controller</p>
        <p>Add the following after String password. This will hold our users first and last name</p>
        <pre>
            <code>String fname
String lname</code>
        </pre>

        <p>Now let us create a new domain for Catch</p>
        <img src='images/newDomain.png' />
        <p>In our new domain, we shall create variables for the trip name, fish type, comments, x and y coordinates, the date caught, and a path to where we will store our uploaded images</p>
        <p>The <b>Catch.groovy</b> domain should look as follows:</p>
        <pre>
            <code>package fishingapp

    class Catch {
        String tripName
        String fishType
        String comment
        Float xCoord
        Float yCoord
        Date dateCaught
        String image

        static belongsTo = [user: User]

        static constraints = {
            tripName blank: false
            fishType blank: false
            comment nullable: true
            xCoord nullable: true
            yCoord nullable: true
            dateCaught blank: false
            image nullable: true
        }
    }</code>
        </pre>

        <p>The Catch domain needs a controller, lets create one</p>
        <img src='images/newController.png' />

        <p>We will also need a controller for our User</p>
        <img src='images/newControllerUser.png' />


        <p>Grails uses a 
                <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC architectural pattern</a>
                . The controller is where we will be handling all the database transications called from the view
            </p>
            
        <p>Awesome! These will be our controllers for the application. We will come back to these later to create some methods</p>



        <br /><hr><br />

        <h3>Step 3: Bootstrapping and Permissions</h3>
        <p>Before we do anything else with the app, we are going to change some permissions and bootstrap (preload) some data into our database</p>
        <p>To change permissions to certain pages in our app go to <b>grails-app → conf → application.groovy</b></p>
        <p>In the static rules, add the following to the bottom. These permissions will let us have access to the catch controller methods, the service worker, User getLogin method, and access to H2 console.</p>
        <pre>
            <code>grails.plugin.springsecurity.controllerAnnotations.staticRules = [

        ... ,

        [pattern: '/logout/**',      access: ['permitAll']],  // for easy access to logout
	[pattern: '/catch/**',       access: ['permitAll']],  // for catch controller
	[pattern: '/sw.js',          access: ['permitAll']],  // for service worker
	[pattern: '/User/getLogin',  access: ['permitAll']],  // to check user login info
        [pattern: '/dbconsole/**',   access: ['ROLE_ADMIN']], // for access to H2 console
    
]</code>
        </pre>
        <p>And yes, we have not created all of these pages / methods yet. We will get to that soon I promise.</p>
        <p>Now that the permissions are set let's bootstrap some data! <b>Open up init → fishingapp → BootStrap</b></p>
        <p>Inside the BootStrap.groovy file everything can be created in the init definition. Add the following to the definition: </p>
        <pre>
            <code>def init = { servletContext →

    def today = new Date()

    // Add for creating Roles and Users
    def adminRole = new Role(authority: 'ROLE_ADMIN').save(flush: true)
    def userRole = new Role(authority: 'ROLE_USER').save(flush: true)

    // Create the admin account and save it
    def testAdmin = new User(username: 'jake', password: 'password', fname: 'Jake', lname: 'Mager')

    testAdmin.save(flush: true)

    UserRole.create testAdmin, adminRole, true
    UserRole.withSession {
        it.flush()
        it.clear()
    }

    // Create a fish and save it
    def fish = new Catch(tripName: "Up State", fishType: "Walleye", comment: "It was cold", dateCaught: today, xCoord: 47.1211, yCoord: 88.5694, image: "IwillBreakEverything", user: testAdmin)
    
    fish.save(flush:true)

}</code>
        </pre>
        <p>Permissions and Bootstrapping complete! Time for the controller</p>

        <br /><hr><br />

        <h3>Step 4: Back to the Controller</h3>
        <p>Open back up the Catch controller and put the following inside the CatchController class:</p>
        <pre><code>def springSecurityService</code></pre>
        <p>This will give us access to spring security services</p>
        <p>Now create a method called getCatches, we will then use spring security to get the user and return all the catches by the user</p>
        <pre>
            <code>def getCatches() {
    User user = springSecurityService.currentUser
    render Catch.findAllByUser(user).toArray() as JSON
}</code>
        </pre>
        <p>Let's test this out. Run the grails app 
            <img width=13px src='https://cdn2.iconfinder.com/data/icons/large-glossy-svg-icons/512/go_arrow_next_up_green_forward-512.png' />
            and navigate to <u>http://localhost:8080/login/auth</u>
        </p>
        <p>Log in with our bootstrapped account <b>username:</b> Jake <b>password:</b> password</p>
        <p>Now navigate to <u>http://localhost:8080/catch/getCatches</u> this is the controller we just made</p>
        <p>The website should return something like this</p>
        <img src='images/catchesGetCatches.png' />
        <p>Cool!! Our method works as it should</p>
        <p>Time to create a method for the <b>User</b> controller to check if the user is logged in, so open up the <b>User</b> controller and create a getLogin method</p>
        <pre>
            <code>class UserController {
    def springSecurityService
    
    // this function checks if the user is logged in
    def getLogin() {
        User user = springSecurityService.currentUser

        if (user != null) {
            render user.fname
        } else {
            render false
        }

    }
}</code>
        </pre>

        <p>We can test this method the same as the Catch one by going to the URL <u>http://localhost:8080/user/getLogin</u> it should display "Jake" if you're logged in and "false" if you're not</p>
        <p>Now that we have that setup, let's get to setting up our navbar!</p>

        <br /><hr><br />

        <h3>Step 5: Main Template, Javascripts, and Styling</h3>
        <p>Before we get to creating the navigation bar, we need to install bootstrap and localforage</p>
        <p>Download the 
            <a href="fishingAppFiles.zip" target="_blank">assets</a>,
             this includes bootstrap 3.3.7, localforage, pre-made CSS, and a logo image. Put all these resources in the relative folders of your project.
        </p>
        <p>You will have to delete <b>main.css, grails.css, bootstrap.js, jquery-2.2.0.min.js, and bootstrap.css</b> from your assets first!</p>
        <p>After you are done, your asset directory should look like this:</p>
        <img src='images/assets.png' />
        <p>Sweet, now that we have all that installed, let us start creating the navigation</p>
        <p>This will all be done in <b>grails-app → views → layouts → main.gsp</b></p>
        <p>The main.gsp makes a template, that can be used on all pages of our app. Once you open main.gsp, include all the JS and CSS you just added in the header </p>
        <pre>
            <code>&lt;head>
    ...

    &lt;asset:javascript src="jquery-3.1.1.js" />
    &lt;asset:javascript src="bootstrap.js" />
    &lt;asset:javascript src="localforage/localforage.js" />

    &lt;asset:stylesheet src="bootstrap.css" />
    &lt;asset:stylesheet src="bootstrap-theme.css" />
    &lt;asset:stylesheet src="main.css"/>

    ...
&lt;/head></code>
        </pre>

        <p>Delete the div with the class "navbar navbar-default navbar-static-top"</p>
        <p>In its place we will put the login modal (a simple boilerplate modal I made a long time ago)</p>
        <pre>
            <code>%{--Login DIV--}%
&lt;div class="modal fade" id="login" role="dialog">
    &lt;div class="modal-dialog">
        &lt;div class="login s2ui_center ui-corner-all" style="text-align:center">
            &lt;div class="login-inner">
                &lt;g:form controller="login" action="authenticate" method="post" autocomplete="off">
                    &lt;div id="login-inner" class="sign-in">
                        &lt;h2>FishingApp&lt;/h2>

                        &lt;div>
                            &lt;input autofocus="autofocus" name="username" id="username" type="text" class="form-control" placeholder="Username">
                        &lt;/div>

                        &lt;div class="passwordDiv">
                            &lt;input name="password" id="password" type="password" class="form-control" placeholder="Password">
                        &lt;/div>

                        &lt;g:actionSubmit value="Login" class="button" />
                    &lt;/div>
                &lt;/g:form>
            &lt;/div>
        &lt;/div>
    &lt;/div>
&lt;/div></code>
        </pre>

        <p>We will also replace the old navigation bar with our own:</p>
        <pre>
            <code>
&lt;div id="navContainer">
    &lt;nav id="navMain">
        &lt;a id="mainLogoText" href="/">&lt;g:img id="mainLogo" dir="images" file="logo.png"  /> FishingApp&lt;/a>
        &lt;a class="loginBtn" id="loginBtn">Login&lt;/a>
    &lt;/nav>
&lt;/div>
            </code>
        </pre>

        <p>We will make the login modal alive using javascript, main.gsp uses application.js by default so open that up under javascripts asset</p>
        <p>First include a no conflict for jQuery, it seems to be interfering with the modals</p>
        <code>jQuery.noConflict(); // for use with modals</code>
        <p>Then we will add a listener for the login anchor to open the login modal</p>
        <pre>
            <code>// listener for login anchor
$('#loginBtn').click(function() {
    $("#login").modal();
});</code>
        </pre>
        <p>Go ahead and test out the login! Remember you can go to <u>http://localhost:8080/user/getLogin</u> to see if it worked.</p>
        <p>Time to finish up the nav bar, once we log in we want to switch that login button to logout. We also want to let the user know if they are in offline mode.</p>
        <p>To do this let's create a function called getLogin() in the application.js</p>
        <p>In the function we need to handle if the user is online or offline, to do this create a conditional statement using 
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator">navigator.onLine</a>
            <code>if (navigator.onLine) { ... } else { ... }</code></pre>
        </p>
        <p>Remeber that method we made earlier in the User controller? Time to use it</p>
        <p>If the user is online we will want to switch the login button to logout. The user can logout by going to http://localhost:8080/logout</p>
        <pre>
            <code>// call method getLogin in user
$.get("user/getLogin", function (firstName) {

    // check if user is logged in
    if (firstName !== 'false') {
        
        // replace navContainer with new navigation HTML
        $("#navContainer").html(
            "&lt;nav id='navMain'>" +
                "&lt;a id='mainLogoText' href='/'>&lt;img id='mainLogo' src='/assets/logo.png'  /> FishingApp&lt;/a>" +
                "&lt;a class='loginBtn' href='/logout'>log out&lt;/a>" +
            "&lt;/nav>" +
            "&lt;nav id='navUser'>" +
                "&lt;a>Logged in as " + firstName + "!</a>" +
            "&lt;/nav>"
        );

        $("#showCatchesButton").show();

        return username;

    } else { // the navbar is already made with 'login'
        return false;
    }
});</code>
        </pre>
        <p>The getLogin method returns false if the user is not logged in, else we will display the users firstname by recreating the navbar</p>
        <p>We will also want to display if the user is in offline mode. This is simply remaking the navbar HTML. Place the following code into the else statement:</p>
        <pre>
            <code>            $("#navContainer").html(
    "&lt;nav id='navMain'>" +
        "&lt;a id='mainLogoText' href='/'>&lt;img id='mainLogo' src='/assets/logo.png'  /> FishingApp&lt;/a>" +
    "&lt;/nav>" +
    "&lt;nav id='navUser'>" +
        "&lt;a>Offline Mode&lt;/a>" +
    "&lt;/nav>"
);

return false;</code>
        </pre>
        <p>Now the navigation bar is finished!</p>
        <p>You can now test and see that the login button is now effective! Unfortuntly you will not be able to test the offline part yet</p>
    
        <br /><hr><br />

        <h3>Step 6: index.gsp</h3>
        <p>Go ahead and open up the index.gsp, this is where all the HTML for the app will be done</p>
        <p>For simplicity sake, we will just be using
            <a href="https://getbootstrap.com/docs/4.0/components/modal/">Bootstrap Modals</a>
            , however this app would be possible with multiple pages
        </p>
        <p>To start just delete everything currently in between the body tag of the HTML</p>
        <p>Now place our styling in between the head tag <code>&lt;asset:stylesheet src="index.css" /></code></p>
        <p>There will need to be a div for the catch queue and a div for saved catches, there also need a button for the new catch modal and to display the saved catches</p>
        <p>This will cover everything:</p>
        <pre>
            <code>&lt;div id="container">

    %{-- Catch Queue Div --}%
    &lt;div id="catchQueue">&lt;/div>

    &lt;button class='button' id="newCatchButton">New Catch&lt;/button> &lt;br />

    %{-- Show Catches div--}%
    &lt;button class='button' id="showCatchesButton">Your Catches&lt;/button>
    &lt;div id="showCatches">&lt;/div>

&lt;/div></code>
        </pre>

        <p>Now for the new catch modal, just place this under the container</p>
        <pre>
            <code>%{-- New Catch Modal--}%
&lt;div class="modal fade" id="newCatch" role="dialog">
    &lt;div class="modal-dialog">
        &lt;form>
            &lt;input type="hidden" id="modalCatchID" />
            &lt;h2>New Catch&lt;/h2>
            &lt;label for="tripName">Trip Name&lt;/label>
            &lt;input type="text" id="tripName" placeholder="The name of your trip...">

            &lt;label for="fishType">Fish Type&lt;/label>
            &lt;input type="text" id="fishType" placeholder="The type of fish you caught...">

            &lt;label for="dateCaught">Date Caught&lt;/label>
            &lt;input type="date"  id="dateCaught" />

            &lt;label for="xCoord">X-Coordinate&lt;/label>
            &lt;input type="num" id="xCoord" placeholder="X coordinate of fish location">

            &lt;label for="yCoord">Y-Coordinate&lt;/label>
            &lt;input type="num" id="yCoord" placeholder="Y coordinate of fish location">

            &lt;label for="comment">Comment&lt;/label>
            &lt;input type="text" id="comment" placeholder="Anything you would like to mention?">

            &lt;label for="image">Upload Image&lt;/label>
            &lt;input id="image" type="file" accept="image/*" capture />
            &lt;div id="imageDiv">&lt;/div>

            &lt;button id="submitNewCatch" class="button" type="button">Submit&lt;/button>
            &lt;button type="button" id="closeNewCatch" class="button center-block" >Close&lt;/button>
        &lt;/form>
    &lt;/div>
&lt;/div></code>
        </pre>

        <p>There also needs to be a modal for when a user edits a catch (yes we are going that far)</p>
        <pre>
            <code>%{-- catchDetail Modal --}%
&lt;div class="modal fade" id="catchDetail" role="dialog">
    &lt;div class="modal-dialog">
        &lt;a id='editCatchButton' onclick="editCatch()">EDIT&lt;/a>
        &lt;div id="displayTripModal">Placeholder eh&lt;/div>
    &lt;/div>
&lt;/div></code>
        </pre>

        <p>Last but not least! Including <b>index.js</b> in the index.gsp</p>
        <p>To do this, put the following at the bottom of the index.gsp (after the closing html tag)</p>
        <pre>
            <code>&lt;content tag="footScripts">
    &lt;asset:javascript src="index.js"/>
&lt;/content></code>
        </pre>

        <p>The index.gsp page is all done now!</p>


        <br /><hr><br />

        <h3>Step 7: Finishing the Catch Controller</h3>
        <p>Open the CatchController.groovy back up. We already implemented a getCatches() method. We also need a method for saving new catches, saving edited catches, and showing the details of a catch</p>
        <p>First up: saving catches. Create a newCatch method <code>def newCatch()</code></p>
        <p>Remember we need to save the following:</p>
        <ul>
            <li>User</li>
            <li>Trip name</li>
            <li>Fish type</li>
            <li>Date caught</li>
            <li>X coordinate</li>
            <li>Y coordinate</li>
            <li>Comment</li>
            <li>Image path</li>            
        </ul>
        <p>An image will also need to be saved on the server</p>

        <p>In the method we can get the user by making a variable and using spring security service</p>
        <code>User user = springSecurityService.currentUser</code>

        <p>Grails handles saving dates very strictly, we must parse the input</p>
        <code>def dateCaughtModified = new Date().parse("yyyy-MM-dd", params.dateCaught)</code>

        <p>If an image is passed we need to generate a path name and save the image to the server</p>
        <p>The image will be saved in <b>src → webapp → Images</b> &nbsp; You will have to create this directory</p>
        <p>If you are on a server the path will not use <code>System.getProperty("user.home")</code></p>
        <p>The following code saves the image:</p>
        <pre>
            <code>def destFilename
def imageUpload = params.image

// if image was passed else make it null (queue sends null parameter as string)
if (imageUpload != null && imageUpload != "null") {
    def destDir = System.getProperty("user.home") + "/[YOUR PATH HERE]/FishingApp/src/main/webapp/Images"

    def id = UUID.randomUUID().toString()
    while (Catch.countByImage(id) > 0) {  // if this photo name already exist make a new one
        id = UUID.randomUUID().toString()
    }


    destFilename = String.format("%s.jpg", id)
    File destFile = new File(destDir, destFilename)

    destFile.createNewFile()
    imageUpload.transferTo(destFile)

} else {
    destFilename = null
}</code>
        </pre>
        <p>Make sure that you modify <code>"/[YOUR PATH HERE]/FishingApp/src/main/webapp/Images"</code> to where you have the app saved</p>
        <p>Time to save it all!</p>
        <pre>
            <code>def fishCatch = new Catch(
    user: user,
    tripName: params.tripName,
    fishType: params.fishType,
    dateCaught: dateCaughtModified,
    xCoord: params.xCoord,
    yCoord: params.yCoord,
    comment: params.comment,
    image: destFilename,
)

fishCatch.save(flush: true, failOnError: true)
render "OH YES OH YES"</code>
        </pre>

        <p><a href="http://www.carlcox.com/">Awesome!</a> Now we can save catches</p>

        <p>Next, make a method <b>editCatch()</b> to save any edited catches</p>
        <p>It is basically the same thing as <b>newCatch()</b> except it is getting a catch to overwrite:</p>
        <pre>
            <code>// updates the catch in the database
def editCatch() {

    def imagePath
    def dateCaughtModified = new Date().parse("yyyy-MM-dd", params.dateCaught)

    Catch getCatch = Catch.get(params.ID)   // get the catch

    // if there is no image for the current catch
    if (getCatch.image != null) {
        imagePath = getCatch.image
    } else {
        imagePath = String.format("%s.jpg", UUID.randomUUID().toString())
    }


    // replace image
    def imageUpload = params.image

    if (imageUpload != null) {
        def destDir = System.getProperty("user.home") + "/[YOUR PATH HERE]/FishingApp/src/main/webapp/Images"
        File destFile = new File(destDir, imagePath)
        destFile.createNewFile()
        imageUpload.transferTo(destFile)
        getCatch.image = imagePath
    }

    // replace everything else
    getCatch.tripName = params.tripName
    getCatch.fishType = params.fishType
    getCatch.dateCaught = dateCaughtModified
    getCatch.xCoord = Float.parseFloat(params.xCoord)
    getCatch.yCoord = Float.parseFloat(params.yCoord)
    getCatch.comment = params.comment


    getCatch.save(flush: true, failOnError: true)
    render "OH YES OH YES"
}</code>
        </pre>

        <p>Lastly, we need a method to return the catches details. Make method <b>getCatch()</b>:</p>
        <pre>
            <code>def getCatch() {
    render Catch.findAllById(params.catchID).toArray() as JSON
}</code>
        </pre>
        <p>This returns a JSON of all the domain variables of the catch from it's ID</p>
        <p><b>Congrats!</b> The controller is complete, can't wait to test it!</p>

        <br /><hr><br />

        <h3>Step 8: Starting index.js</h3>
        <p>Go ahead and create new file index.js in the javascripts assets</p>
        <img src='images/newIndexJS.png' />
        <p>We are going to be making a lot of functions here. This is where most of the action is going on.</p>
        <p>First lets create a button listener and function so we can display all of the users catches</p>
        <p>Whenever we make any listeners, make sure to put them in the <code>$(document).ready(function() { ... }</code> function</p>
        <p>This will always allow the javascript to find the IDs on the page after it loads</p>
        <p>To create a listener for a button in jquery do the following:</p>
        <pre>
<code>$('#showCatchesButton').click(function() {
    ...
}</code>
        </pre>
        <p>Get the div with ID "showCatches" and check if it is visible, if it is hide it. If not check if there is data 
            in the table so we don't make any unessessary calls to the server. If not lets get the catches!</p>
        <pre>
<code>// get show catch div
var showCatchesDiv = $('#showCatches');

// check if div is visible, hide it if not
if (showCatchesDiv.is(":visible")) {
    showCatchesDiv.hide();

// this checks if we already loaded data into the div so we don't have to call to server again
} else if (showCatchesDiv.children().length) {
    showCatchesDiv.show();

// call to the controller Catch, method getCatches
} else { ... </code>
        </pre>
        <p>Remember that controller we made earlier? getCatches - Yeah that one. We can make an ajax call using </p>
        <code>$.getJSON("catch/getCatches", function (data) { ...</code>
        <p>This returns a JSON inside the data variable and if it has any length we know it has data and we can easily extract it and put it to use</p>
        <pre>
<code>
        var catches = [];

        // if the user has catches
        if (data.length > 0) {

            catches.push("&lt;table>" +
                            "&lt;tr>" +
                                "&lt;th>Trip&lt;/th>&lt;th>Type&lt;/th>&lt;th>Date&lt;/th>" +
                            "&lt;/tr>"
            );
            // getCatches returns an array converted as JSON, go through the JSON file creating populated rows
            $.each(data, function (key, val) {
                catches.push(
                    "&lt;tr id='catch_" + val.id + "' onclick='showCatchDetail(" + val.id + ")'>" +
                        "&lt;td>" + val.tripName + "&lt;/td>" +
                        "&lt;td>" + val.fishType + "&lt;/td>" +
                        "&lt;td>" + val.dateCaught.substring(0, 10) + "&lt;/td>" +
                    "&lt;/tr>"
                );
            });
            catches.push("&lt;/table>");

            // combine the rows as one HTML object and push it to the showCatches div
            $(
                catches.join("")
            ).appendTo("#showCatches");

        } else {

            // if there isn't anything in the database
            showCatchesDiv.html("You haven't caught anything yet!");

        }

        // make the div visible
        showCatchesDiv.show();
    });
}</code>
        </pre>
        <p>See the showCatchDetail function in <code>&lt;tr id='catch_" + val.id + "' onclick='showCatchDetail(" + val.id + ")'>&lt;/tr></code> ??</p>
        <p>Lets implement that now, all it needs to do is make another ajax call to the getCatch method in the controller and with its return data put it in the display trip modal</p>
        <p>Remember this isn't a listener so we can put it above the document ready function</p>
        <pre>
<code>function showCatchDetail(index) {

        $.getJSON("catch/getCatch", { catchID: index }, function (data) {
    
            // getCatch returns an array converted as JSON
            // only returns one JSON object
            // has a hidden paragraph tag with ID as value
            $.each(data, function (key, val) {
                $("#displayTripModal").html(
                    "&lt;h2 id='tripNameModal'>" + val.tripName + "&lt;/h2>" +
                    "&lt;div id='tripModalData'>" +
                        "&lt;b>Date: &lt;/b>&lt;p id='dateCaughtModal'>" + val.dateCaught.substring(0, 10) + "&lt;/p>&lt;br />" +
                        "&lt;b>Fish Type: &lt;/b>&lt;p id='fishTypeModal'>" + val.fishType + "&lt;/p>&lt;br />" +
                        "&lt;b>Comments: &lt;/b>&lt;p id='commentModal'>" + val.comment + "&lt;/p>&lt;br />" +
                        "&lt;b>Location: &lt;/b>&lt;p id='xCoordModal'>" + val.xCoord + "&lt;/p>, &lt;p id='yCoordModal'>" + val.yCoord + "&lt;/p>&lt;br />"
                );
    
                // if there is an image append it!
                if (val.image !== null) {
                    $("#displayTripModal").append("&lt;img class='catchDetailImg' src='../../Images/" + val.image + "'/>&lt;/div>");
                }
    
                $("#modalCatchID").text(index)
            });
    
        });
    
        $("#editCatchButton").show();
        $("#catchDetail").modal();
    
    }</code>
        </pre>
    
    <p>Go ahead and test it!</p>
    <img src='images/catchDetailFunction.png' />
    <p>The reason for no image is because we put a pseduo link in the bootstrap</p>
    <p>See the edit button at the top right? We might as well as finish this</p>
    <p>Make a function editCatch() that is just going to extract everything from the modal then put it in textboxs</p>
    <pre>
<code>function editCatch() {
    var tripName = $("#tripNameModal").text();
    var fishType = $("#fishTypeModal").text();
    var dateCaught = $("#dateCaughtModal").text();
    var comment = $("#commentModal").text();
    var xCoord = $("#xCoordModal").text();
    var yCoord = $("#yCoordModal").text();


    $("#displayTripModal").html(
        "&lt;form>" +
            "&lt;p>Trip Name&lt;/p>" +
            "&lt;input id='modalTripName' type='text' class='modalTextbox' value='" + tripName + "' />&lt;br />" +

            "&lt;p>Fish Type&lt;/p>" +
            "&lt;input id='modalFishType' type='text' value='" + fishType + "' />&lt;br />" +

            "&lt;p>Comment&lt;/p>" +
            "&lt;input id='modalComment' type='text' value='" + comment + "' />&lt;br />" +

            "&lt;p>X Coord&lt;/p>" +
            "&lt;input id='modalXCoord' type='text' value='" + xCoord + "' />&lt;br />" +

            "&lt;p>Y Coord&lt;/p>" +
            "&lt;input id='modalYCoord' type='text' value='" + yCoord + "' />&lt;br />" +

            "&lt;p>Date Caught&lt;/p>" +
            "&lt;input id='modalDateCaught' type='date' value='" + dateCaught + "' />&lt;br />" +

            "&lt;p>Image&lt;/p>" +
            "&lt;input id='modalImage' type='file' accept='image/*' capture />" +

            "&lt;input type='submit' onclick='submitEditCatch()' class='button' />" +
        "&lt;/form>"
    );

    $("#editCatchButton").hide();
}</code>
    </pre>

    <p>This of course doesn't work yet - we need the submitEditCatch function. But lets wait to make the submit new catch function fist!</p>
    <p>But before we get to that - this is an offline app. We need to get the app ready for offline implementation fist</p>


    <br /><hr><br />

    <h3>Step 9: Making the App Offline</h3>
    <p>Implementing the webapp offline is not that difficult to do. To do this we will be caching the app to the users device using service workers.
        All the data will be store in IndexedDB using localForage.</p>
    <p>More detailed guides: 
        <a href="https://developers.google.com/web/ilt/pwa/caching-files-with-service-worker">service workers</a> and 
        <a href="https://localforage.github.io/localForage/">localForage</a>
    </p>

    <p>LocalForage will make it easy to cache items in IndexedDB and if that is not available it will then store it into Local Storage.
       The reason we are using IndexedDB is because it is allowed to store a larger amount than Local Storage. </p>

    <p>First things first, create sw.js in the src → webapp directory.</p>
    <p>This is actually very simple, we will make listener for service worker install and fetch</p>
    <p>The install can be done as below. This makes a listener for the install then opens the cache for 'fishingApp' and adds all of the pages that need to be saved offline to the cache.</p>
    <pre>
<code>self.addEventListener('install', function (event) {
        self.skipWaiting();
        event.waitUntil(
            caches.open('fishingApp').then(function (cache) {
                return cache.addAll(
                    [
                        '/',
                        '/assets/jquery-3.1.1.js?compile=false',
                        '/assets/index.css?compile=false',
                        '/assets/main.css?compile=false',
                        '/assets/bootstrap.css?compile=false',
                        '/assets/bootstrap-theme.css?compile=false',
                        '/assets/bootstrap.js?compile=false',
                        '/assets/index.js?compile=false',
                        '/assets/application.js?compile=false',
                        '/assets/logo.png',
                        '/assets/localforage/localforage.js?compile=false',
                        '/assets/localforage/localforage.min.js?compile=false',
                        '/assets/localforage/localforage.nopromises.js?compile=false',
                        '/assets/localforage/localforage.nopromises.min.js?compile=false',
                    ]
                );
            })
        );
        console.log('Install event:', event);
    });</code>
    </pre>

    <p>The links are slightly differnt than what you would expect because grails compiles the code like this. It also adds the <code>?compile=false</code> to the end of all the assets.</p>

    <p>Next the fetch, which comes from <a href="https://developers.google.com/web/ilt/pwa/caching-files-with-service-worker">Google Developers</a></p>
    <pre>
<code>self.addEventListener('fetch', function(event) {
    event.respondWith(
        caches.match(event.request).then(function(response) {
            return response || fetch(event.request);
        })
    );
});</code>
    </pre>

    <p>Lastly, we need to register the service worker! Navigate back to index.js</p>
    <p>In the document ready function let's first check if the app is online and if it is register the service worker</p>
    <p>To check if the app is online use: <code>if (navigator.onLine) { ... }</code></p>
    <p>Then to register the service worker (after checking if it is supported)</p>
    <pre>
        <code>if ('serviceWorker' in navigator) {
    navigator.serviceWorker
        .register('/sw.js')
        .then(function() { console.log("Service Worker Registered"); });
}</code>
    </pre>
    <p>and if the app isn't online, might as well as hide the show catches button <code>$("#showCatchesButton").hide();</code></p>

    <p>The app is now offline capable! Go ahead and test it - on Google Chrome you can go to View → Developer → Javascript Console</p>
    <p>Under the Application tab, you can click 'Service Workers' and check Offline</p>
    <img src='images/jsConsole.png' />
    <br />
    <img src='images/offlineMode.png' />

    
    <br /><hr><br />

    <h3>Step 10: Saving to the Database</h3>
    <p>Time to save the catches to the database! We will be using the controller newCatch method to save everything</p>
    <p>In <b>index.js</b> let's first make an event listener for our new catch button to open the modal we made earlier </p>
    <pre>
        <code>$('#newCatchButton').click(function() {
    $("#newCatch").modal();
});</code>
    </pre>

    <p>and a listener to close the modal</p>
    <pre>
<code>$('#closeNewCatch').click(function() {
    $("#newCatch").modal('toggle');
});</code>
        </pre>

    <p>Now time to make the listner when the catch is submited - we will extract the data from the form then send it to the controller or save it to the users cache with localforage</p>
    <pre>
<code>$('#submitNewCatch').click(function() {

    var tripName = $("#tripName");
    var fishType = $("#fishType");
    var dateCaught = $("#dateCaught");
    var comment = $("#comment");
    var xCoord = $("#xCoord");
    var yCoord = $("#yCoord");
    var imageUpload = $('#image')[0].files[0];</code>
    </pre>

    <p>Let's do some quick user validation before we do anything</p>
    <pre>
    <code>    if (dateCaught.val() === "") {
        dateCaught.css("border", "1px solid red");
        alert("Enter a date!");
        return;
    } else if (tripName.val() === "") {
        tripName.css("border", "1px solid red");
        alert("Enter a trip name!");
        return;
    } else if (fishType.val() === "") {
        fishType.css("border", "1px solid red");
        alert("Enter a fish type!");
        return;
    }</code>
    </pre>

    <p>We are then going to check if the user is online and logged in</p>
    <code>if (navigator.onLine && $("#loginBtn").text() !== "Login") { ... }</code>
    
    <p>If it is, we are going to put everything in a jform</p>
    <pre>
<code>    var jForm = new FormData();

    if (imageUpload !== undefined) {
        jForm.append("image", imageUpload);
    }

    jForm.append("tripName", tripName.val());
    jForm.append("fishType", fishType.val());
    jForm.append("dateCaught", dateCaught.val());
    jForm.append("comment", comment.val());
    jForm.append("xCoord", xCoord.val());
    jForm.append("yCoord", yCoord.val());</code>
    </pre>

    <p>Now time for ajax!</p>
    <pre>
<code>    $.ajax({
        url: "catch/NewCatch",
        type: "POST",
        data: jForm,
        mimeType: "multipart/form-data",
        contentType: false,
        cache: false,
        processData: false,

        success: function() {
            tripName.val("");
            fishType.val("");
            dateCaught.val("");
            comment.val("");
            xCoord.val("");
            yCoord.val("");
            $('#image').val("");
            alert("Saved catch!");
        }
    });</code>
    </pre>

    <p>If you try to upload any images you will notice that grails says the upload size is too large. We must change the max upload size.</p>
    <p>Open up the <b>application.yml</b> and put the following under the <code>controllers:</code></p>
    <pre>
<code>upload:
    maxFileSize: 262144000
    maxRequestSize: 262144000</code>
    </pre>
    <p>Rerun the app and you will now be able to uplaod larger images!</p>

    <p>Now it is time to handle if the user is not online, we will save to the user cache using localForage </p>
    <p>To do this we will be storing the data in an array of dictonaries with the photo being stored as a blob in key value pair orientation</p>
    <p>First things first, lets check if the user is attempting to upload an image with their catch</p>
    <code>if (imageUpload !== undefined) {</code>
    <p>And if they are we will use a <a href='https://developer.mozilla.org/en-US/docs/Web/API/FileReader'>FileReader</a> to convert the image to a blob</p>
    <p>Then generate a photoID to use a key</p>
    <pre>
<code>if (imageUpload !== undefined) {
    // for converting image to blob string setup
    var reader = new FileReader();
    reader.readAsDataURL(imageUpload);

    var photoID = generateGUID();   // generate id for the photos
}</code>
    </pre>

    <p>The function for generateGUID will need to be added to the top of index.js</p>
    <pre>
<code>// Use with generateGUID function to make random int
function genString() {
    return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
}

// For generating unique ID
function generateGUID() {
    return (genString() + genString() + "-" + genString() + "-4" + genString().substr(0,3) + "-" + genString() + "-" + genString() + genString() + genString()).toLowerCase();
}</code>
    </pre>

    <p>Next we will need to put everything in the localforage, which is done by first setting the driver - which is IndexedDB</p>
    <code>localforage.setDriver(localforage.INDEXEDDB).then(function() { ...</code>
    <p>Then put all of the data in a dictonary</p>
    <pre>
<code>var catchData = {
    tripName: tripName.val(),
    fishType: fishType.val(),
    dateCaught: dateCaught.val(),
    comment: comment.val(),
    xCoord: xCoord.val(),
    yCoord: yCoord.val()
};</code>
    </pre>

    <p>If there is an image, store it as it's own key value pair or make it null in our dictonary</p>
    <pre>
<code>if (imageUpload !== undefined) {
    catchData.photoID = photoID;    // put it in the dictionary

    // store image in localForage
    reader.onloadend = function() {
        localforage.setItem(photoID, reader.result);    // reader.result is the blob string
    };

} else {

    catchData.photoID = null;   // put it in the dictionary as null
}</code>
    </pre>
    
    <p>Now let's store the catch in the localForage, to do this check if there is already an array in the localForage
        and if there is, duplicate and push the new data to the array
    </p>

    <pre>
<code>            var catches = [];

            // get the key first
            localforage.getItem('catches', function (err, value) {

                // if there is anything in 'catches' we will push to it
                if (value !== null) {
                    catches = value;
                }

                catches.push(catchData);


                // clear localforage catches
                localforage.setItem('catches', catches, function () {
                    alert("Added " + tripName.val() + " to queue, Login to upload catch!");
                    tripName.val("");
                    fishType.val("");
                    dateCaught.val("");
                    comment.val("");
                    xCoord.val("");
                    yCoord.val("");
                    $('#image').val("");
                })
            });
        });
    }
});</code>
    </pre>
    
    <p>Saving an edited catch is basically the same: </p>
    <pre>
<code>function submitEditCatch() {
        var catchID = $("#modalCatchID");
        var tripName = $("#modalTripName");
        var fishType = $("#modalFishType");
        var dateCaught = $("#modalDateCaught");
        var comment = $("#modalComment");
        var xCoord = $("#modalXCoord");
        var yCoord = $("#modalYCoord");
        var imageUpload = $("#modalImage");
    
    
        var jForm = new FormData();
    
        // if there is an image, append it to the form
        if (imageUpload[0].files.length) {
            jForm.append("image", imageUpload[0].files[0]);
        } else {
            imageUpload = null;
        }
    
        jForm.append("ID", catchID.text());
        jForm.append("tripName", tripName.val());
        jForm.append("fishType", fishType.val());
        jForm.append("dateCaught", dateCaught.val());
        jForm.append("comment", comment.val());
        jForm.append("xCoord", xCoord.val());
        jForm.append("yCoord", yCoord.val());
    
    
        $.ajax({
            url: "catch/editCatch",
            type: "POST",
            data: jForm,
            mimeType: "multipart/form-data",
            contentType: false,
            cache: false,
            processData: false,
    
            success: function() {
                $("#catchDetail").modal('hide');
                $("#showCatches").html("");
                $("#showCatches").css("display", "none");
            }
        });
    }</code>
    </pre>
    
    <br /><hr><br />

    <h3>Step 11: Finishing the queue</h3>
    <p>Now that we have the data at least saving to the queue if the user is offline/not logged in. Lets test that out by showing the queue in the div we made earlier</p>
    <p>In the document ready function we will want to check if anything is in the localforage and if it is, put it in the queue</p>
    <pre>
<code>localforage.setDriver(localforage.INDEXEDDB).then(function() {

    localforage.getItem('catches', function (err, value) {
        if (value != null) {
            var html = "&lt;table>&lt;tr>&lt;th>Catch Queue:&lt;/th>&lt;/tr>";

            for (var i = 0; i < value.length; i++) {
                html += "&lt;tr>&lt;td>" + value[i].tripName + "&lt;/tr>&lt;/td>";
            }

            html += "&lt;tr>&lt;td>&lt;button id='submitQueue' onclick='submitQueue()' class='button'>Upload Queue&lt;/button>&lt;/td>&lt;/tr>&lt;/table>";
            $("#catchQueue").html(html);
        }
    });
});</code>
    </pre>

    <p>Go ahead and test it to make sure that the queue works, you will have to either be logged out or offline to test this!</p>
    
    <p>Time to now save the queue when a user is logged in</p>
    <p>Go ahead a create a function for submitQueue()</p>
    <p>This checks if the user is logged in and online, then proceeds to go through each item in a queue - but we must send each catch to another 
        function to avoid race conditions when accessing the localForage for the image blob</p>
        <pre>
<code>function submitQueue() {

    // check if the user is logged in (kinda hacky)
    if ($("#loginBtn").text() !== "Login") {

        // check if user is online
        if (navigator.onLine) {

            // if they are, enter localforage and extract info
            localforage.setDriver(localforage.INDEXEDDB).then(function () {
                localforage.getItem('catches', function (err, value) {

                    // go through each item in the 'catches' key
                    for (var i = 0; i < value.length; i++) {
                        submitQueueHelper(value[i]);    // This function is called to avoid race conditions
                    }

                    // after all items in the queue are submitted, remove them
                    localforage.removeItem('catches', function (err, value) {
                        $("#catchQueue").html("&lt;b>Successfully Uploaded!&lt;/b>");
                    })
                });
            });

        } else {
            // user not online
            alert("You have to be online to do that!")
        }
    } else {
        // user not logged in
        alert("Log in first!");
    }

}</code>
    </pre>

    <p>The submitQueueHelper function is almost identical to saving a new catch function</p>
    <p>The differnce is that we must handle if a user has an image or not differntly and convert the blob text back to something grails can use</p>

    <pre>
<code>function submitQueueHelper(value) {

    // All data being sent to catch/NewCatch is stored in here
    var jForm = new FormData();

    // if there is a photo
    if (value.photoID !== null) {
        // This is getting the photo of the catch out of localforage
        // it then makes a promise in which the ajax is called after
        // it is full filled
        localforage.getItem(value.photoID, function (err, data) {

            // convert the blob string back to an appropriate file
            var block = data.split(";");
            var contentType = block[0].split(":")[1];
            var realData = block[1].split(",")[1];
            var image = b64toBlob(realData, contentType);


            jForm.append("tripName", value.tripName);
            jForm.append("fishType", value.fishType);
            jForm.append("dateCaught", value.dateCaught);
            jForm.append("comment", value.comment);
            jForm.append("xCoord", value.xCoord);
            jForm.append("yCoord", value.yCoord);
            jForm.append("image", image);

        }).then(function () {

            $.ajax({
                url: "catch/NewCatch",
                type: "POST",
                data: jForm,
                mimeType: "multipart/form-data",
                contentType: false,
                cache: false,
                processData: false
            });

            localforage.removeItem(value.photoID);

        });


    } else {

        jForm.append("tripName", value.tripName);
        jForm.append("fishType", value.fishType);
        jForm.append("dateCaught", value.dateCaught);
        jForm.append("comment", value.comment);
        jForm.append("xCoord", value.xCoord);
        jForm.append("yCoord", value.yCoord);
        jForm.append("image", null);

        $.ajax({
            url: "catch/NewCatch",
            type: "POST",
            data: jForm,
            mimeType: "multipart/form-data",
            contentType: false,
            cache: false,
            processData: false
        });
    }
}</code>
    </pre>

    <p>The convert b64toBlob function (from <a href='https://ourcodeworld.com/'>OurCodeWorld.com</a></p>
    <pre>
<code>// Converts blob string to a blob file
// Taken from https://ourcodeworld.com/
function b64toBlob(b64Data, contentType, sliceSize) {
    contentType = contentType || '';
    sliceSize = sliceSize || 512;

    var byteCharacters = atob(b64Data);
    var byteArrays = [];

    for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
        var slice = byteCharacters.slice(offset, offset + sliceSize);

        var byteNumbers = new Array(slice.length);
        for (var i = 0; i < slice.length; i++) {
            byteNumbers[i] = slice.charCodeAt(i);
        }

        var byteArray = new Uint8Array(byteNumbers);

        byteArrays.push(byteArray);
    }

    var blob = new Blob(byteArrays, {type: contentType});
    return blob;
}</code>
    </pre>


    <br /><hr><br />

    <h3>Extras</h3>
    <p>The extent that this tutorial takes the app is basically done!</p>
    <p>A little extra though</p>
    <p>This function automatically gets the users location and puts it in the appropriate fields</p>
    <pre>
<code>// Finds location using navigator and sets the values for newCatch
function geoFindMe() {

    if (!navigator.geolocation){
        //print some error here if you want
        return;
    }

    function success(position) {
        var latitude = position.coords.latitude;
        var longitude = position.coords.longitude;

        $("#xCoord").val(latitude);
        $("#yCoord").val(longitude);

    }

    function error() {
        //handle failed retrieve
    }

    navigator.geolocation.getCurrentPosition(success, error);
}</code>
    </pre>

    <p>Then call <code>geoFindMe()</code> in the document ready function</p>

    <br />
    <p>Also a cool way to display image preview for the user when they upload an image (from <a href='html5rocks.com'>HTML5 Rocks!</a>)</p>
    <pre>
<code>// Displays thumbnail of selected image in the imageDiv
// this function is from HTML5 rocks!
function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object
    var f = files[0];

    if (f.type.match('image.*')) {
        var reader = new FileReader();

        // Closure to capture the file information.
        reader.onload = (function(theFile) {
            return function(e) {
                // Render thumbnail.
                var span = document.createElement('span');
                span.innerHTML = ['<img class="thumb" src="', e.target.result, '" />'].join('');
                $('#imageDiv').html(span);

            };
        })(f);

        // Read in the image file as a data URL.
        reader.readAsDataURL(f);
    } else {
        alert("Invalid File!");
    }

}</code>
    </pre>

    <br /><hr><br />

    <p>Congrats on completing the tutorial! I hope that this had provided some new knowledge for you to use with your future projects!</p>
    <p>- Jake</p>



    </div>

    <script>
        var myIndex = 0;
        carousel();

        function carousel() {
            var i;
            var x = document.getElementsByClassName("mySlides");
            for (i = 0; i < x.length; i++) {
            x[i].style.display = "none";  
            }
            myIndex++;
            if (myIndex > x.length) {myIndex = 1}    
            x[myIndex-1].style.display = "block";  
            setTimeout(carousel, 5000);    
        }
    </script>
</body>
</html>